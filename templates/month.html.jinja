{% extends "layout/default.html.jinja" %}
{% import 'macros.html.jinja' as macros %}

{% block title %}Monthly GTFS Quality Reports: {{date_month_year}}{% endblock %}

{% block content %}
<div class="responsive-prose">
    {{ macros.breadcrumbs([
        { 'url': '/', 'text': 'Home' },
        { 'url': '/#directory', 'text': 'Directory' },
        { 'text': date_month_year },
    ]) }}

    <h1>
        GTFS Quality Reports<br>
        <small>{{date_month_year}}</small>
    </h1>
</div>

{# Alpine.js component #}
<div class="my-12" x-data="{
        resultsCount: null,
        rawQuery: '',
        get query() { return this.rawQuery.trim().toLowerCase(); },
    }" x-init="$watch('query', () => {
        $nextTick(() => {
            if (query == '') {
                resultsCount = null;
            } else {
                resultsCount = document.querySelectorAll('#report-list li[data-report]:not([hidden])').length;
            }
        });
    })">

    <input class="w-full sm:max-w-sm" type="search" spellcheck="false" placeholder="Search for an agency&hellip;"
        x-model="rawQuery">

    <ul id="report-list" class="list-group border shadow-sm max-w-prose mt-4">
        {% set crnt_entries = month["reports"] %}
        {% for entry in crnt_entries -%}
        <li data-report :hidden="query.length > 0 && !('{{ entry.agency_name }}'.toLowerCase().includes(query))">
            <a class="list-group__link" href="{{SITE_PATH}}/{{PATH_GTFS_SCHEDULE}}/{{ entry['report_path'] }}">
                {# use flex so wrapped items will stay aligned next to icon #}
                <div class="flex items-baseline">
                    <div class="pt-1 -mt-1 mr-2">
                        {{ macros.list_group_icon() }}
                    </div>
                    <div>
                        {{ entry["agency_name"] }}
                    </div>
                </div>
            </a>
        </li>
        {% endfor %}
        <li :hidden="resultsCount !== 0">
            <div class="p-4">
                No reports match <strong class="whitespace-pre" x-text="rawQuery"></strong>
            </div>
        </li>
    </ul>
</div>
{# /component #}
{% endblock %}
